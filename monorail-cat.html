<!DOCTYPE HTML>
<html>
	<head>
		<title>Monorail Cats : The GAME!</title>

		<script type="text/javascript" src="vendor/jsGameSoup-v173/js/jsgamesoup.js"></script>
		<script type="text/javascript" src="vendor/jsGameSoup-v173/js/sprite.js"></script>
		<script type="text/javascript" src="libs/common.js"></script>
		<script type="text/javascript" src="libs/ui.js"></script>
		<script type="text/javascript" src="libs/tilemap.js"></script>
		<script type="text/javascript" src="libs/map.js"></script>
		<script type="text/javascript" src="libs/player.js"></script>
		<script type="text/javascript" src="libs/game_sound.js"></script>
		<script type="text/javascript" src="libs/game.js"></script>
		<script type="text/javascript" src="libs/entity.js"></script>
		<script type="text/javascript" src="libs/map_item.js"></script>

		<link rel="stylesheet" href="main.css" type="text/css" />
	</head>

	<body onload="initPage();">
		<div id="header">
			<p>
				<img src="arts/title.png"></img>
			</p>
		</div>
		<div>
			<p class="bottomLine"><span class="left"><span id="MapList"></span></span>
				<img src="arts/instructions.png" alt="Instructions" title="Instructions" onclick="showInstructions();"></img>
				&nbsp;<img src="arts/information.png" alt="Credits" title="Credits" onclick="showCredits();"></img>
				&nbsp;<a href="mapEditor.html"><img src="arts/mapEditor.png" alt="Map Editor" title="Map Editor"></img></a>
				&nbsp;<img src="arts/settings.png" alt="Settings" title="Settings" onclick="showSettings();"></img>
				&nbsp;<img id="muteIcon" src="arts/sound_on.png" alt="Sound Mute" title="Sound Mute" onclick="muteUnmute(); if(SOUND_ON) { this.src = 'arts/sound_on.png' } else { this.src = 'arts/sound_off.png' };"></img>
			</p>
		</div>
		<div id="gameBoard">
			<div id="player1">
				<p class="playerName" id="player1name">Player 1</p>
				<p><img class="bonusImage" src="arts/blank.png" id="player1bonus"></img></p>
				<p class="lives" id="player1lives"></p>
			</div>
			<div id="player2">
				<p class="playerName" id="player2name">Player 2</p>
				<p><img class="bonusImage" src="arts/blank.png" id="player2bonus"></img></p>
				<p class="lives" id="player2lives"></p>
			</div>
			<div id="gameView">
				<canvas id="tileMap" height="553" width="554" style="position:relative; top:10px; left:0px; z-index:1;"></canvas>
				<canvas id="monorail-cat" height="553" width="554" style="position:relative; top:-550px; left:-5px; z-index:2;"></canvas>
			</div>
			<div id="startGameLine">
				<p><input type="button" value="PLAY TEH GAME" onclick="startGame(); this.onclick= function() { location.reload(); }; this.value='RESTART GAME';"></p>
			</div>
		</div>
		<div id="msg"></div>

		<script type="text/javascript">
			function initPage() {
				// Players Lives.
				UI.setPlayerLives(1, 9);
				UI.setPlayerLives(2, 9);
				// Loading map list
				var xhr;
				xhr = getXHR();
				xhr.onreadystatechange  = function() {
					if(xhr.readyState  == 4) {
						if(xhr.status  == 200) {
							generateMapList(xhr.responseText);
						} else {
							generateMapList('default');
						}
					}
				};
				xhr.open("GET", 'map.php?GET=',  true);
				xhr.send(null);
				// Title song
				GameSound.getInstance().playLoop("openning");
				// Load User Settings and selected map
				reloadSettings();
			}

			function generateMapList(list) {
				// if a map is already selected
				var tmp = readCookie('mapId');
				if(tmp!=null) {
					tmp = trim(tmp);
				} else {
					tmp = 'default';
				}
				var maplist = 'Choose a map&nbsp;:&nbsp;<select onchange="loadMap(this.value); createCookie(\'mapId\', this.value);">';
				var maps = list.split("\n");
				for(var i=0; i<maps.length; i++) {
					var mapname = trim(maps[i]);
					if(mapname != '') {
						maplist += '<option';
						if(mapname == tmp) {
							maplist += ' selected="selected"';
						}
						maplist += '>'+mapname+'</option>';
					}
				}
				maplist += '</select>';
				e('MapList').innerHTML = maplist;
			}

			function showInstructions() {
				UI.printMsg('<iframe src="instructions.html" width="530px" height="360px" style="border:none; background:url(arts/bg2.png) repeat;"></iframe>' , undefined, -1, undefined);
			}

			function showCredits() {
				UI.printMsg('<iframe src="credits.html" width="530px" height="360px" style="border:none; background:url(arts/bg2.png) repeat;"></iframe>' , undefined, -1, undefined);
			}

			function showSettings() {
				UI.printMsg('<iframe src="settings.html" width="530px" height="360px" style="border:none; background:url(arts/bg2.png) repeat;"></iframe>' , undefined, -1, 'reloadSettings()');
			}

			function reloadSettings() {
				// Setting mute/unmute according to cookie if exists
				var tmp = readCookie('sound_on');
				if(tmp != null) {
					if((SOUND_ON && (tmp!='true'))||((! SOUND_ON) && (tmp!='false'))) {
						muteUnmute();
						if(! SOUND_ON) {
							e('muteIcon').src = 'arts/sound_off.png';
						} else {
							e('muteIcon').src = 'arts/sound_on.png';
						}
					}
				}
				// Setting players names
				player1Name = getPlayerName(1);
				UI.setPlayerName(1, player1Name);
				player2Name = getPlayerName(2);
				UI.setPlayerName(2, player2Name);
				// Setting keymap
				player1Keymap = getPlayerKeyMap(1);
				player2Keymap = getPlayerKeyMap(2);
				// Load default map
				tmp = readCookie('mapId');
				if(tmp!=null) {
					loadMap(trim(tmp));
				} else {
					loadMap('default');
				}
			}
		</script>
	</body>
</html>
